- name: Print subnet details
  debug:
    msg: "{{vpc.subnets[0].name, vpc.subnets[0].cidr}}"

- name: Gather VPC facts
  ec2_vpc_net_facts:
    filters:
      "tag:Name": "{{vpc.name}}"
    region: "{{region}}"
  environment:
    AWS_ACCESS_KEY_ID: "{{aws_access_key}}"
    AWS_SECRET_ACCESS_KEY: "{{aws_secret_key}}"
  register: vpc_details
  tags:
    - ec2_operations

# arg: subnet_tag
- name: Get subnet details by tag
  ec2_vpc_subnet_facts:
    region: "{{region}}"
    filters:
      vpc-id: "{{vpc_details.vpcs[0].id}}"
      "tag:Name": "{{subnet_tag}}"
  environment:
    AWS_ACCESS_KEY_ID: "{{aws_access_key}}"
    AWS_SECRET_ACCESS_KEY: "{{aws_secret_key}}"
  register: target_subnet_details
  tags:
    - ec2_operations

- name: Print target_subnet_details
  debug:
    msg: "{{target_subnet_details}}"
